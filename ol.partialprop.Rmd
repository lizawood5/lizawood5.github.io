---
title: Ordered Logits - Proportional and partial-proportional cumulative models
subtitle: A quick look at polr and vglm
---

Logistic regression models that want to regress on an **ordinal** dependent variable (think: Likert scale responses, course grades, categories that have a natural sequence, etc.) will use an **ordered logit**. Ordered logits are often run in R using `polr` in the MASS package, however the `vglm` function in the VGAM package offers a more advanced suite of options. This tutorial walks through setting up ordered logits with each function.  

First, let's load in our packages
```{r setup, echo=T, include = F}
library(MASS) # polr package
library(VGAM) # vglm package
library(brant) # Brant test of proportional odds
library(dplyr)
```

```{r, include = F}
df <- read.csv("data/farmer.sample.data.2.csv")
dfr <- round(df[ ,c(3,5,6)], 2)
dff <- df[ ,c(1,2,4,7)]
df <- cbind(dfr, dff)
colnames(df)[4] <- "interest"

df$interest <- ifelse(df$interest == "None", "Not",
                      ifelse(df$interest == "Conceptual", "Somewhat",
                      ifelse(df$interest == "Applied", "Very", NA)))
df <- df %>% dplyr::select(interest, acres, income, education, econ.value, envt.value, info.count)
```

For this example, suppose we are interested in the question: What drives farmers' interest in technology x? We have data on farmers' education and income, their farm size, as well as their attitudes towards things like earning money, protecting the environment, as well has how connected they are to different information sources. We are interested in the dependent variable: Farmer interest in the technology, scored as not, somewhat, or very (1-3). Let's inspect this data
```{r inspect data}
head(df)
# Make sure your dependent variable is in the right order
df$interest = factor(df$interest, c('Not', 'Somewhat', 'Very'))
```

**Cumulative logits with polr**  

Most ordered logit models, such as those run with the defaults of the `polr` function, assume a cumulative link function. A cumulative link function looks at the probability of being at one level, compared to all of the levels below them P[Y...]

Given these

```{r models}
polr.model <- polr(interest ~ acres + income + education + econ.value + envt.value + info.count, data = df, Hess = T)
summary(polr.model)
```

One assumption of ordered logits that ought to be tested is the proportional odds assumption. What is assumed here is that the slopes from level to level of the dependent variable are relatively similar, allowing us to use only one coefficient per independent variable. The Brant test was developed to test this assumption, and the brant package and function allow us to quickly test this with `polr` model objects.  
```{r }
brant(polr.model)
```

Based on these outputs, we see that the overall model fails the proportional odds test, and this is particularly driven by economic values. 

We need to run a non-proportional ordered logit, or at least partial proportional model. However,     `polr` doesn't allow us to do this, which is where we switch to `vglm`.

**Cumulative logits with vglm**  

VGAM can model more advanced ordinal regressions -- non-proportional and partial proportional, as well as different link functions. However, it requires a few more model specifications than the `polr` model. First, you need to specify the family. As noted above, the default family for `polr` and most people thinking about ordered logits is the cumulative link function, so for now we will leave it at that with `family = cumulative`. (This blog post explains the cratio link function). We also get to specify whether or not the parallel odds assumption, also called the proportional odds assumption, has been met with `parallel = T/F`. Last, the default in `vglm` is to reverse the order of the ordered dependent variable, so most intuitive interpretations require that the order be reversed with `reverse = T`.

```{r, warning=F, error=F}
vgam.model.prop = vglm(ordered(interest) ~ acres + income + education + econ.value + envt.value + info.count, 
                       data = df, family=cumulative(parallel = T, reverse = T))

vgam.model.nonprop = vglm(ordered(interest) ~ acres + income + education + econ.value + envt.value + info.count, 
                          data = df, family=cumulative(parallel = F, reverse = T))

vgam.model.partialprop = vglm(ordered(interest) ~ acres + income + education + econ.value + envt.value + info.count, 
                              data = df, family=cumulative(parallel = F ~ priority_econ, reverse = T))
```


